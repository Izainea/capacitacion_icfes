<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lección 3.3: Arquitectura y Modularización</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&family=Teko:wght@400;600&display=swap" rel="stylesheet">

    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --primary-color: #ff9900; /* AWS Orange */
            --secondary-color: #232f3e; /* AWS Dark Blue */
            --text-color: #e0e0e0;
            --text-muted: #a0a0a0;
            --border-color: #333;
            --success-color: #28a745;
            --info-color: #5dade2;
        }

        html { scroll-behavior: smooth; }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 40px 20px;
            text-align: center;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: auto;
        }

        h1, h2, h3, h4 {
            font-family: 'Teko', sans-serif;
            font-weight: 600;
            letter-spacing: 1px;
        }

        h1 {
            font-size: 4.5rem;
            color: var(--primary-color);
            margin-bottom: 0;
        }
        
        h2 {
            font-size: 3rem;
            color: var(--text-color);
            border-bottom: 2px solid var(--primary-color);
            display: inline-block;
            padding-bottom: 10px;
            margin-top: 80px;
        }

        .subtitle {
            font-size: 1.6rem;
            color: var(--text-muted);
            margin-top: 0;
            margin-bottom: 80px;
        }

        .section {
            margin-bottom: 100px;
        }

        p {
            font-size: 1.2rem;
            line-height: 1.7;
            color: var(--text-muted);
            max-width: 800px;
            margin: 20px auto 40px;
            text-align: left;
        }
        .center-p {
             text-align: center;
        }
        
        pre {
            background-color: #0d1117;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            text-align: left;
            font-family: 'Courier New', Courier, monospace;
            font-size: 1rem;
            white-space: pre-wrap;
            word-wrap: break-word;
            color: #c9d1d9;
        }

        .step-guide {
            text-align: left;
            max-width: 900px;
            margin: 40px auto;
        }
        .step {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            border-left: 4px solid var(--primary-color);
        }
        .step h3 {
            font-size: 2.2rem;
            color: var(--primary-color);
            margin-top: 0;
        }
        
        .info-box {
            background: rgba(40, 167, 69, 0.1);
            border-left: 5px solid var(--success-color);
            padding: 20px;
            border-radius: 10px;
            text-align: left;
            margin-top: 30px;
        }
        .info-box h4 {
            margin-top: 0;
            font-size: 1.8rem;
            color: var(--success-color);
        }
        .info-box p {
            margin: 10px 0 0 0;
            font-size: 1.1rem;
        }

        .navigation-section {
            background: var(--secondary-color); padding: 60px 30px; border-radius: 15px; margin-top: 80px;
        }
        .navigation-section h2 { border: none; }
        .nav-buttons {
            display: flex; justify-content: center; gap: 20px; margin-top: 30px; flex-wrap: wrap;
        }
        .nav-button {
            padding: 15px 30px; border: none; border-radius: 50px; font-size: 1.2rem; font-weight: bold; text-decoration: none;
            transition: transform 0.3s, box-shadow 0.3s; display: inline-flex; align-items: center; gap: 10px; cursor: pointer;
        }
        .back-button {
            background-color: var(--card-bg); color: var(--primary-color); border: 2px solid var(--primary-color);
        }
        .next-button {
            background-color: var(--primary-color); color: var(--secondary-color);
        }
        .next-button.disabled {
            background-color: var(--border-color); color: var(--text-muted); cursor: not-allowed;
        }
        .nav-button:hover:not(.disabled) {
            transform: scale(1.05); box-shadow: 0 5px 20px rgba(0,0,0,0.5);
        }

    </style>
</head>
<body>

    <div class="container">

        <header>
            <h1>Arquitectura y Modularización</h1>
            <p class="subtitle center-p">De un Archivo a una Aplicación: Estructurando el Código para Crecer.</p>
        </header>

        <main>
            <section class="section" id="introduccion">
                <h2>El Problema del Archivo Monolítico</h2>
                <p>
                    Cuando empezamos con Shiny, el archivo <code>app.R</code> es nuestro mejor amigo. Es simple, directo y contiene todo lo que necesitamos. Sin embargo, a medida que nuestra aplicación crece, este amigo se convierte en un monstruo. Un único archivo con miles de líneas de código, mezclando la lógica de la interfaz, los cálculos del servidor, la carga de datos y los estilos, se vuelve increíblemente difícil de leer, depurar y mantener.
                </p>
                <p>
                    Intentar encontrar un error en un <code>app.R</code> masivo es como buscar una aguja en un pajar. La colaboración se vuelve una pesadilla, con múltiples personas intentando editar el mismo archivo. Para construir aplicaciones robustas y escalables, debemos abandonar el monolito y adoptar una <strong>arquitectura modular</strong>.
                </p>
            </section>
            
            <section class="section" id="estructura">
                <h2>La Estructura Profesional: Separación de Responsabilidades</h2>
                <p class="center-p">La clave de una buena arquitectura es la "separación de responsabilidades". Cada parte del código debe hacer una sola cosa y hacerla bien. En Shiny, esto se traduce en una estructura de tres archivos principales que reemplazan a <code>app.R</code>:</p>
                <div class="step-guide">
                    <div class="step" style="border-left-color: var(--info-color);">
                        <h3><code>global.R</code>: El Preparador</h3>
                        <p><strong>Responsabilidad:</strong> Preparar el entorno. Este script se ejecuta <strong>una sola vez</strong> cuando la aplicación se inicia. Es el lugar perfecto para todo el código que no necesita cambiar mientras la app está en uso, como:</p>
                        <ul>
                            <li>Cargar todas las librerías necesarias (<code>library(shiny)</code>, <code>library(dplyr)</code>, etc.).</li>
                            <li>Cargar los datos desde archivos (ej. <code>read_delim()</code>).</li>
                            <li>Definir funciones personalizadas que se usarán en el servidor.</li>
                            <li>Establecer conexiones a bases de datos.</li>
                        </ul>
                    </div>
                    <div class="step" style="border-left-color: var(--primary-color);">
                        <h3><code>ui.R</code>: El Arquitecto Visual</h3>
                        <p><strong>Responsabilidad:</strong> Definir la interfaz de usuario. Este archivo debe contener <strong>únicamente</strong> el objeto de la UI (ej. <code>ui <- fluidPage(...)</code>). Su única misión es describir qué ve el usuario: los paneles, los botones, los sliders y los espacios para los outputs. No debe contener ninguna lógica de cálculo.</p>
                    </div>
                    <div class="step" style="border-left-color: var(--success-color);">
                        <h3><code>server.R</code>: El Cerebro Lógico</h3>
                        <p><strong>Responsabilidad:</strong> Contener toda la lógica reactiva. Este archivo debe definir <strong>únicamente</strong> la función del servidor (<code>server <- function(input, output, session) { ... }</code>). Aquí es donde viven los conductores reactivos, los observadores y los renderizadores de outputs. Es el motor que responde a las interacciones del usuario.</p>
                    </div>
                </div>
            </section>
            
            <section class="section" id="taller">
                <h2>Taller Práctico: Refactorizando a una Arquitectura Modular</h2>
                <p class="center-p">Vamos a tomar nuestra aplicación y a transformarla, pasando de un solo <code>app.R</code> a la estructura profesional de tres archivos.</p>
                <div class="step-guide">
                    <div class="step">
                        <h3>Paso 1: Crear <code>global.R</code></h3>
                        <p>En la raíz de tu proyecto, crea un nuevo archivo llamado <code>global.R</code>. Corta y pega todo el código de configuración que está al inicio de tu <code>app.R</code> en este nuevo archivo.</p>
                        <pre><code># Contenido de global.R

# 1. Cargar todas las librerías
library(shiny)
library(readr)
library(dplyr)
library(ggplot2)
library(plotly)
library(bslib)

# 2. Cargar y preparar datos (se hace una sola vez)
datos_saber <- read_delim("data/raw/Examen_Saber_11_20242.txt", delim = ";", show_col_types = FALSE) %>%
  na.omit()

# 3. Crear objetos globales que la UI o el Server puedan necesitar
puntajes_choices <- datos_saber %>%
  select(starts_with("punt_")) %>%
  names()
</code></pre>
                    </div>
                    <div class="step">
                        <h3>Paso 2: Crear <code>ui.R</code></h3>
                        <p>Crea un archivo <code>ui.R</code>. Corta la definición completa del objeto <code>ui</code> de tu <code>app.R</code> y pégala aquí.</p>
                        <pre><code># Contenido de ui.R

# El archivo solo debe contener esto:
ui <- fluidPage(
  theme = bs_theme(bootswatch = "darkly"),
  titlePanel("Dashboard Exploratorio Pruebas Saber 11"),
  
  # ... todo el resto del contenido de la UI ...
  
)
</code></pre>
                    </div>
                     <div class="step">
                        <h3>Paso 3: Crear <code>server.R</code></h3>
                        <p>Finalmente, crea un archivo <code>server.R</code>. Corta la definición completa de la función <code>server</code> de tu <code>app.R</code> y pégala en este archivo.</p>
                        <pre><code># Contenido de server.R

# El archivo solo debe contener esto:
server <- function(input, output, session) {

  # ... toda tu lógica reactiva (eventReactive, observeEvent, renderPlotly, etc.) ...
  
}
</code></pre>
                    </div>
                    <div class="step">
                        <h3>Paso 4: Eliminar <code>app.R</code> y Verificar</h3>
                        <p>Ahora que todo el código ha sido movido a su lugar correcto, el archivo <code>app.R</code> está vacío y ya no es necesario. <strong>Puedes eliminarlo de forma segura.</strong></p>
                        <p>Shiny está diseñado para detectar esta estructura. Si no encuentra un archivo <code>app.R</code>, buscará automáticamente un <code>ui.R</code> y un <code>server.R</code>. Ejecuta tu aplicación de la manera habitual (con el botón "Run App" o <code>shiny::runApp()</code>). Debería funcionar exactamente igual que antes, ¡pero ahora tu código está limpio, organizado y listo para escalar!</p>
                        <div class="info-box">
                           <h4><i class="fa-solid fa-folder-tree"></i> Tu Nueva Estructura Profesional</h4>
                           <p>La raíz de tu proyecto ahora refleja un estándar de la industria, fácil de entender para cualquier desarrollador de R.</p>
                           <pre><code>/mi-proyecto/
|-- data/
|-- R/
|-- .gitignore
|-- global.R   # Carga y preparación
|-- server.R   # Lógica reactiva
|-- ui.R       # Interfaz de usuario
`-- README.md
</code></pre>
                        </div>
                    </div>
                    <div class="step">
                        <h3>Paso 5: Versionar la Refactorización</h3>
                        <p>Este es un cambio estructural masivo y un hito en la madurez de tu proyecto. Es fundamental registrarlo adecuadamente en Git.</p>
                        <pre><code># Git detectará la eliminación de app.R y la creación de los nuevos archivos.
git add .

# Un commit que describe claramente la refactorización arquitectónica.
git commit -m "refactor(core): Modulariza la app en la estructura global/ui/server"

# Sube los cambios al repositorio remoto.
git push
</code></pre>
                    </div>
                </div>
            </section>
            
            <section class="section navigation-section">
                <h2>¿Qué Sigue?</h2>
                <p class="center-p">Con una aplicación bien estructurada y un control preciso sobre la reactividad, solo nos queda un pilar por dominar: ¿qué hacer cuando las cosas no funcionan como esperamos? La depuración.</p>
                <div class="nav-buttons">
                    <a href="conductores_reactivos.html" class="nav-button back-button"><i class="fa-solid fa-arrow-left"></i> Lección 3.2: Conductores</a>
                    <a href="depuracion_diagnostico.html" class="nav-button next-button">Siguiente: Depuración y Diagnóstico <i class="fa-solid fa-arrow-right"></i></a>
                </div>
            </section>
        </main>
    </div>

</body>
</html>
