<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lección 4.1: Creando Artefactos de Procesamiento de Datos</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&family=Teko:wght@400;600&display=swap" rel="stylesheet">

    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --primary-color: #ff9900; /* AWS Orange */
            --secondary-color: #232f3e; /* AWS Dark Blue */
            --text-color: #e0e0e0;
            --text-muted: #a0a0a0;
            --border-color: #333;
            --success-color: #28a745;
            --info-color: #5dade2;
        }

        html { scroll-behavior: smooth; }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 40px 20px;
            text-align: center;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: auto;
        }

        h1, h2, h3 {
            font-family: 'Teko', sans-serif;
            font-weight: 600;
            letter-spacing: 1px;
        }

        h1 {
            font-size: 4.5rem;
            color: var(--primary-color);
            margin-bottom: 0;
        }
        
        h2 {
            font-size: 3rem;
            color: var(--text-color);
            border-bottom: 2px solid var(--primary-color);
            display: inline-block;
            padding-bottom: 10px;
            margin-top: 80px;
        }

        .subtitle {
            font-size: 1.6rem;
            color: var(--text-muted);
            margin-top: 0;
            margin-bottom: 80px;
        }

        .section {
            margin-bottom: 100px;
        }

        p {
            font-size: 1.2rem;
            line-height: 1.7;
            color: var(--text-muted);
            max-width: 800px;
            margin: 20px auto 40px;
            text-align: left;
        }
        .center-p {
             text-align: center;
        }
        
        pre {
            background-color: #0d1117;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            text-align: left;
            font-family: 'Courier New', Courier, monospace;
            font-size: 1rem;
            white-space: pre-wrap;
            word-wrap: break-word;
            color: #c9d1d9;
        }
        
        .step-guide {
            text-align: left;
            max-width: 900px;
            margin: 40px auto;
        }
        .step {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            border-left: 4px solid var(--primary-color);
        }
        .step h3 {
            font-size: 2.2rem;
            color: var(--primary-color);
            margin-top: 0;
        }
        
        .info-box {
            background: rgba(93, 173, 226, 0.1);
            border-left: 5px solid var(--info-color);
            padding: 20px;
            border-radius: 10px;
            text-align: left;
            margin-top: 30px;
        }
        .info-box h4 {
            margin-top: 0;
            font-size: 1.8rem;
            color: var(--info-color);
        }
        .info-box p, .info-box ol {
            margin: 10px 0 0 0;
            font-size: 1.1rem;
        }
        .info-box li { margin-bottom: 5px; }

        .project-structure {
            font-family: 'Courier New', Courier, monospace;
            background-color: var(--card-bg);
            padding: 30px;
            border-radius: 10px;
            text-align: left;
            font-size: 1.1rem;
            border: 1px solid var(--border-color);
            max-width: 600px;
            margin: 40px auto;
        }
        .project-structure ul { list-style-type: none; padding-left: 20px; }
        .project-structure li { margin-bottom: 10px; }
        .project-structure .folder { color: #5dade2; }
        .project-structure .file { color: #e0e0e0; }
        .project-structure .highlight { color: var(--primary-color); font-weight: bold; }
        
        .navigation-section {
            background: var(--secondary-color); padding: 60px 30px; border-radius: 15px; margin-top: 80px;
        }
        .navigation-section h2 { border: none; }
        .nav-buttons {
            display: flex; justify-content: center; gap: 20px; margin-top: 30px; flex-wrap: wrap;
        }
        .nav-button {
            padding: 15px 30px; border: none; border-radius: 50px; font-size: 1.2rem; font-weight: bold; text-decoration: none;
            transition: transform 0.3s, box-shadow 0.3s; display: inline-flex; align-items: center; gap: 10px; cursor: pointer;
        }
        .back-button {
            background-color: var(--card-bg); color: var(--primary-color); border: 2px solid var(--primary-color);
        }
        .next-button {
            background-color: var(--primary-color); color: var(--secondary-color);
        }
        .next-button.disabled {
            background-color: var(--border-color); color: var(--text-muted); cursor: not-allowed;
        }
        .nav-button:hover:not(.disabled) {
            transform: scale(1.05); box-shadow: 0 5px 20px rgba(0,0,0,0.5);
        }
    </style>
</head>
<body>

    <div class="container">

        <header>
            <h1>Creando Artefactos de Procesamiento de Datos</h1>
            <p class="subtitle center-p">El pilar de MLOps para desacoplar, versionar y reutilizar la lógica de datos.</p>
        </header>

        <main>
            <section class="section" id="introduccion">
                <h2>El Principio MLOps: Desacoplar Lógica</h2>
                <p>
                    En el desarrollo de software y MLOps, un principio fundamental es la **separación de responsabilidades**. Esto significa que cada pieza de nuestro sistema debe hacer una sola cosa y hacerla bien. Mezclar la lógica de preparación de datos con la lógica de la interfaz de usuario (la app Shiny) es una receta para el "spaghetti code": un sistema frágil, difícil de depurar y imposible de escalar.
                </p>
                <p>
                    Por eso, nuestro objetivo en esta lección no es solo aprender a usar `dplyr`. Es aprender a encapsular nuestras transformaciones de datos en un **artefacto**: un script de R (`.R`) autocontenido, versionable y reutilizable. Este script se convierte en un componente fundamental de nuestro pipeline de MLOps, que podremos probar de forma aislada y consumir desde nuestra aplicación Shiny o cualquier otro proceso.
                </p>
            </section>
            
             <section class="section" id="core-dplyr">
                <h2>La Herramienta: Verbos Esenciales de `dplyr`</h2>
                <p class="center-p">Para construir nuestro artefacto de procesamiento, usaremos `dplyr`. Sus "verbos" nos permiten escribir pasos de transformación de datos que son tan legibles como una receta de cocina.</p>
                <div class="step-guide">
                    <div class="step" style="border-left-color: var(--info-color);">
                        <h3><code>select()</code> y <code>filter()</code></h3>
                        <p><strong>`select()`</strong> elige columnas por su nombre. <strong>`filter()`</strong> elige filas basadas en una condición lógica.</p>
                        <pre><code># Selecciona solo las columnas de puntaje y filtra por colegios oficiales
datos_limpios <- datos_saber %>%
  select(starts_with("punt_"), cole_naturaleza) %>%
  filter(cole_naturaleza == "OFICIAL")</code></pre>
                    </div>
                    <div class="step" style="border-left-color: var(--success-color);">
                        <h3><code>mutate()</code></h3>
                        <p>Crea nuevas columnas o modifica existentes. Es el corazón de la ingeniería de características (feature engineering).</p>
                        <pre><code># Crea una nueva columna que promedia los puntajes de ciencias y matemáticas
datos_enriquecidos <- datos_saber %>%
  mutate(promedio_ciencias_mat = (punt_ciencias_naturales + punt_matematicas) / 2)</code></pre>
                    </div>
                    <div class="step" style="border-left-color: var(--primary-color);">
                        <h3><code>group_by()</code> y <code>summarise()</code></h3>
                        <p>Trabajan juntos para realizar resúmenes agregados. <strong>`group_by()`</strong> define los grupos y <strong>`summarise()`</strong> calcula métricas para cada uno.</p>
                        <pre><code># Calcula el puntaje global promedio para cada tipo de colegio
resumen_por_naturaleza <- datos_saber %>%
  group_by(cole_naturaleza) %>%
  summarise(
    puntaje_promedio = mean(punt_global, na.rm = TRUE),
    total_estudiantes = n()
  )</code></pre>
                    </div>
                </div>
            </section>

            <section class="section" id="taller">
                <h2>Guía Práctica: Construcción e Integración del Artefacto</h2>
                <p class="center-p">Ahora que conocemos las herramientas, vamos a aplicar estos principios para crear nuestro primer artefacto de procesamiento y conectarlo a la aplicación, siguiendo la estructura de proyecto definida en el Módulo 1.</p>
                <div class="step-guide">
                    <div class="step">
                        <h3>Paso 1: Ubicar el Artefacto en la Estructura del Proyecto</h3>
                        <p>El primer paso es saber dónde vivirá nuestro nuevo componente. Según la arquitectura MLOps que establecimos, toda la lógica de R reutilizable (funciones de procesamiento, modelado, etc.) debe residir en la carpeta `/R`.</p>
                        
                        <div class="project-structure">
                            <ul>
                                <li><i class="fa-solid fa-folder folder"></i> mi-proyecto/</li>
                                <ul>
                                    <li><i class="fa-solid fa-folder folder"></i> data/</li>
                                    <li><i class="fa-solid fa-folder folder highlight"></i> R/</li>
                                    <ul>
                                        <li><i class="fa-solid fa-file-code file highlight"></i> data_processing.R &nbsp;&nbsp; &lt;-- NUESTRO ARTEFACTO</li>
                                    </ul>
                                    <li><i class="fa-solid fa-file-code file"></i> global.R</li>
                                    <li><i class="fa-solid fa-file-code file"></i> server.R</li>
                                    <li><i class="fa-solid fa-file-code file"></i> ui.R</li>
                                </ul>
                            </ul>
                        </div>
                        <p><strong>Acción:</strong> En tu proyecto, dentro de la carpeta `/R`, crea un nuevo archivo llamado `data_processing.R`.</p>
                    </div>
                    <div class="step">
                        <h3>Paso 2: Desarrollar el Pipeline dentro de una Función</h3>
                        <p>Ahora, escribimos el pipeline de `dplyr`. Es una práctica recomendada envolverlo en una función. Esto lo hace reutilizable y fácil de probar de forma independiente.</p>
                        <p><strong>Acción:</strong> Abre `R/data_processing.R` y añade el siguiente código.</p>
                        <pre><code># Contenido del artefacto: R/data_processing.R

prepare_saber_data <- function(raw_data) {
  
  message("Ejecutando pipeline de preparación de datos...")
  
  processed_data <- raw_data %>%
    na.omit() %>%
    mutate(
      rendimiento_global = case_when(
        punt_global >= 350 ~ "Alto",
        punt_global >= 250 ~ "Medio",
        TRUE ~ "Bajo"
      )
    ) %>%
    select(
      starts_with("punt_"),
      cole_naturaleza,
      rendimiento_global
    )
    
  return(processed_data)
}
</code></pre>
                    </div>
                     <div class="step">
                        <h3>Paso 3: Integrar el Artefacto en la Aplicación</h3>
                        <p>Nuestra aplicación Shiny ahora no procesará los datos directamente. En su lugar, actuará como un **consumidor** de nuestro artefacto. El punto de integración es el archivo `global.R`, que se ejecuta una sola vez al inicio de la aplicación y actúa como nuestro orquestador principal.</p>
                        <p><strong>Acción:</strong> Modifica tu archivo `global.R` para que cargue el script del artefacto y lo utilice.</p>
                        <pre><code># En global.R

# ... (tus librerías: library(shiny), library(dplyr), etc.) ...

# 1. Cargar el artefacto de procesamiento de datos
source("R/data_processing.R")

# 2. Cargar los datos crudos
datos_crudos <- read_delim("data/raw/Examen_Saber_11_20242.txt", delim = ";", show_col_types = FALSE)

# 3. Ejecutar el pipeline para crear el dataframe limpio que usará la app
datos_saber <- prepare_saber_data(datos_crudos)

# ... (el resto de tu código de global.R) ...
</code></pre>
                        <div class="info-box">
                           <h4><i class="fa-solid fa-diagram-project"></i> El Nuevo Flujo de Datos MLOps</h4>
                           <p>Con este cambio, hemos establecido un flujo claro y desacoplado:</p>
                           <ol>
                               <li><strong>`global.R`</strong> actúa como orquestador: carga los datos crudos.</li>
                               <li>Llama a la función desde nuestro artefacto (`R/data_processing.R`) para procesarlos.</li>
                               <li>El resultado (<code>datos_saber</code>) es un dataframe limpio y listo para ser usado por la lógica reactiva en <strong>`server.R`</strong>.</li>
                           </ol>
                        </div>
                    </div>
                    <div class="step">
                        <h3>Paso 4: Versionar el Nuevo Artefacto</h3>
                        <p>Has creado un componente de software modular. Este es un hito importante en el ciclo de vida del proyecto y debe ser registrado en Git con un mensaje que refleje su importancia.</p>
                        <pre><code># Añade el nuevo artefacto y los cambios en el orquestador
git add R/data_processing.R global.R

# Un commit que describe la creación de un componente MLOps
git commit -m "feat(data): Crea artefacto de procesamiento de datos y lo integra en la app"

git push
</code></pre>
                    </div>
                </div>
            </section>
            
            <section class="section navigation-section">
                <h2>¿Qué Sigue?</h2>
                <p class="center-p">Con un pipeline de datos desacoplado y versionado, estamos listos para el siguiente paso: consumir otro tipo de artefacto crucial en MLOps, los modelos predictivos.</p>
                <div class="nav-buttons">
                    <a href="sesion_4.html" class="nav-button back-button"><i class="fa-solid fa-arrow-left"></i> Volver al Módulo 4</a>
                    <a href="integracion_modelos.html" class="nav-button next-button">Siguiente: Integración de Modelos <i class="fa-solid fa-arrow-right"></i></a>
                </div>
            </section>
        </main>
    </div>

</body>
</html>

